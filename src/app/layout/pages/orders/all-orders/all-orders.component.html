<div class="orders-container mat-elevation-z2">

  <h2>Orders</h2>

  <!-- Filters -->
  <form (ngSubmit)="getOrders()" class="filters" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end;">
    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>Governorate</mat-label>
      <input matInput [(ngModel)]="filters.governorate" name="governorate">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>City</mat-label>
      <input matInput [(ngModel)]="filters.city" name="city">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>Status</mat-label>
      <input matInput [(ngModel)]="filters.status" name="status">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>Order ID</mat-label>
      <input matInput type="number" [(ngModel)]="filters.order_id" name="order_id">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>Customer ID</mat-label>
      <input matInput type="number" [(ngModel)]="filters.customer_id" name="customer_id">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>From</mat-label>
      <input matInput type="date" [(ngModel)]="filters.from" name="from">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>To</mat-label>
      <input matInput type="date" [(ngModel)]="filters.to" name="to">
    </mat-form-field>

    <div style="display: flex; gap: 10px; margin-left: auto;">
      <button mat-raised-button color="primary" type="submit">Search</button>
      <button mat-stroked-button color="warn" type="button" (click)="resetFilters()">Reset</button>
    </div>
  </form>

  <!-- Loading Spinner -->
  <div *ngIf="loading" style="text-align:center; margin: 20px 0;">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <!-- Orders Table -->
  <table mat-table [dataSource]="orders" class="mat-elevation-z8" *ngIf="!loading && orders.length">

    <!-- ID Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef> ID </th>
      <td mat-cell *matCellDef="let order"> {{ order.id }} </td>
    </ng-container>

    <!-- Order ID Column -->
    <ng-container matColumnDef="order_id">
      <th mat-header-cell *matHeaderCellDef> Order ID </th>
      <td mat-cell *matCellDef="let order"> {{ order.order_id }} </td>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef> Status </th>
      <td mat-cell *matCellDef="let order">
        <span [ngClass]="order.status.toLowerCase()">{{ order.status }}</span>
      </td>
    </ng-container>

    <!-- Order Date Column -->
    <ng-container matColumnDef="order_date">
      <th mat-header-cell *matHeaderCellDef> Order Date </th>
      <td mat-cell *matCellDef="let order"> {{ order.order_date }} </td>
    </ng-container>

    <!-- Customer Name -->
    <ng-container matColumnDef="customer_name">
      <th mat-header-cell *matHeaderCellDef> Customer </th>
      <td mat-cell *matCellDef="let order"> {{ order.customer_name || '-' }} </td>
    </ng-container>

    <!-- Address -->
    <ng-container matColumnDef="address">
      <th mat-header-cell *matHeaderCellDef> Address </th>
      <td mat-cell *matCellDef="let order"> {{ order.address }} </td>
    </ng-container>

    <!-- Total Items -->
    <ng-container matColumnDef="total_items">
      <th mat-header-cell *matHeaderCellDef> Total Items </th>
      <td mat-cell *matCellDef="let order"> {{ order.total_items }} </td>
    </ng-container>

    <!-- Created At -->
    <ng-container matColumnDef="created_at">
      <th mat-header-cell *matHeaderCellDef> Created At </th>
      <td mat-cell *matCellDef="let order"> {{ order.created_at | date:'short' }} </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="openOrderDetails(row)" class="clickable-row"></tr>
  </table>

  <!-- Pagination -->
  <mat-paginator
    [length]="totalOrders"
    [pageSize]="10"
    [pageIndex]="currentPage - 1"
    (page)="changePage($event)">
  </mat-paginator>

  <!-- No Data -->
  <div class="no-data" *ngIf="!loading && orders.length === 0" style="text-align:center; margin-top:20px;">
    No orders found.
  </div>
</div>
