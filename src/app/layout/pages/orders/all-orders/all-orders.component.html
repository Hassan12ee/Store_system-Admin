<div class="orders-container mat-elevation-z2">

  <h2>Orders</h2>

  <!-- Filters -->
  <form (ngSubmit)="getOrders()" class="filters" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end;">
    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>Governorate</mat-label>
      <input matInput [(ngModel)]="filters.governorate" name="governorate">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>City</mat-label>
      <input matInput [(ngModel)]="filters.city" name="city">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>Status</mat-label>
      <mat-select [(ngModel)]="filters.status" name="status">
        <mat-option value="">All</mat-option>
        <mat-option value="ordered">Ordered</mat-option>
        <mat-option value="confirmed">Confirmed</mat-option>
        <mat-option value="packing">Packing</mat-option>
        <mat-option value="shipped_to_carrier">Shipped to Carrier</mat-option>
        <mat-option value="out_for_delivery">Out for Delivery</mat-option>
        <mat-option value="delivered">Delivered</mat-option>
        <mat-option value="cancelled">Cancelled</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>Order ID</mat-label>
      <input matInput type="number" [(ngModel)]="filters.order_id" name="order_id">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>Customer ID</mat-label>
      <input matInput type="number" [(ngModel)]="filters.customer_id" name="customer_id">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>From</mat-label>
      <input matInput type="date" [(ngModel)]="filters.from" name="from">
    </mat-form-field>

    <mat-form-field appearance="outline" style="flex: 1 1 200px;">
      <mat-label>To</mat-label>
      <input matInput type="date" [(ngModel)]="filters.to" name="to">
    </mat-form-field>

    <div style="display: flex; gap: 10px; margin-left: auto;">
      <button mat-raised-button color="primary" type="submit">Search</button>
      <button mat-stroked-button color="warn" type="button" (click)="resetFilters()">Reset</button>
    </div>
  </form>

  <!-- Loading Spinner -->
  <div *ngIf="loading" style="text-align:center; margin: 20px 0;">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
<!-- Orders Table -->
<table mat-table [dataSource]="orders" class="mat-elevation-z8" *ngIf="!loading && orders.length">

  <!-- ID Column -->
  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef> ID </th>
    <td mat-cell *matCellDef="let order"> {{ order.order_id }} </td>
  </ng-container>

  <!-- Status Column -->
  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef> Status </th>
    <td mat-cell *matCellDef="let order">
      <span class="status" [ngClass]="order.status.toLowerCase()">{{ order.status }}</span>
    </td>
  </ng-container>

    <!-- Customer Name -->
  <ng-container matColumnDef="customer_name">
    <th mat-header-cell *matHeaderCellDef> Customer </th>
    <td mat-cell *matCellDef="let order"> {{ order.customer_name || '-' }} </td>
  </ng-container>

    <!-- Order ID Column -->
  <ng-container matColumnDef="Phone">
    <th mat-header-cell *matHeaderCellDef> Phone </th>
    <td mat-cell *matCellDef="let order"> {{ order.Phone }} </td>
  </ng-container>

  <!-- Order Date Column -->
  <ng-container matColumnDef="Governorate">
    <th mat-header-cell *matHeaderCellDef> Governorate </th>
    <td mat-cell *matCellDef="let order"> {{ order.address.governorate }} </td>
  </ng-container>



  <!-- Address -->
  <ng-container matColumnDef="address">
    <th mat-header-cell *matHeaderCellDef> City </th>
    <td mat-cell *matCellDef="let order"> {{ order.address.city }} </td>
  </ng-container>

  <!-- Total Items -->
  <ng-container matColumnDef="total_items">
    <th mat-header-cell *matHeaderCellDef> Total Items </th>
    <td mat-cell *matCellDef="let order"> {{ order.total_items }} </td>
  </ng-container>

  <!-- Created At -->
  <ng-container matColumnDef="created_at">
    <th mat-header-cell *matHeaderCellDef> Created At </th>
    <td mat-cell *matCellDef="let order"> {{ order.created_at | date:'short' }} </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

  <!-- Clickable Row -->
  <tr 
    mat-row 
    *matRowDef="let row; columns: displayedColumns;" 
    class="clickable-row"
    [routerLink]="['/orders/edit', row.order_id]">
  </tr>

</table>
  <mat-paginator
  [length]="total"
  [pageSize]="perPage"
  [pageIndex]="currentPage - 1"
  [pageSizeOptions]="[5, 10, 20, 50]"
  showFirstLastButtons
  (page)="changePage($event)">
</mat-paginator>


  <!-- No Data -->
  <div class="no-data" *ngIf="!loading && orders.length === 0" style="text-align:center; margin-top:20px;">
    No orders found.
  </div>

</div>
